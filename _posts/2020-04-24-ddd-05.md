---
layout: post
title: DDD 05  (TWIL)
categories: [DDD]
tags: [DDD]
---

# 애그리게잇과 전술적 설계 

## 개념들

### 애그리게잇
 - 애그리게잇 루트, 엔터티, 값 객체로 구성
 - 각 애그리게잇은 일관성 있는 트랜잭션 경계를 형성
     - 커밋 될 때, 한 애그리게잇 내의 모든 구성 요소는 반드시 비즈니스 규칙을 따르면서 일관성 있게 처리된다는 것을 의미함
     - 트랜잭션
          - 애그리게잇에 대한 변경을 독립시키고, 소프트웨어가 언제나 충실히 준수해야하는 규칙인 비즈니스 불변성을 각 비즈니스 오퍼레이션에 맞게 일관성을 보장하는 방법
          - 항상 안전하고 정확하게 트랜잭션으로 처리하고 관리해야 한다
 - 애그리게잇은 개념적으로 완전하게 모델링해야 한다
     - 애그리게잇이 완전하고 유효한 상태로 저장되지 않는다면, 수행된 비즈니스 오퍼레이션은 비즈니스 규칙에 어긋난 것으로 간주 할 수 있다

### 애그리게잇 루트
 - 엔터티 중 하나, 루트 엔터티
 - 해당 애그리게잇의 다른 모든 요소를 소유함
 - 해당 애그리게잇이 모델링하는 개념적 완정성을 적절하게 표현할 수 있는 명칭으로 정의해야함

### 값 객체 
 - 불변의 개념적 완전성을 모델링
 - 고유의 식별성이 없음
 - 속성을 비교함으로써 동일함이 결정됨
 - 엔터티를 서술하고, 수량화하거나 측정하는데 사용됨

### 엔터티
 - 독립성, 식별성. 변화 가능.

## 애그리게잇 생성 원칙
 
### 애그리게잇 경계 내의 비즈니스 불변사항을 보호하라

### 작은 애그리게잇을 설계하라
 - 각 애그리게잇의 메모리 사용량과 트랜잭션 범위가 비교적 작아야 한다
 - 작은 애그리게잇은 개발자에게 부담을 줄여주고 테스트 또한 보다 쉬워진다
 - 단일 책임의 원칙을 따르라

### 오직 식별자로만 다른 애그리게잇을 참고하라
 - 이것은 애그리게잇을 작게 유지하고, 동일한 트랜잭션 내에 여러 애그리겟잇을 수정하려는 접근을 방지해준다
 - 이 규칙은 더 적은 메모리 요구와 리파지토리부터의 빠른 로딩을 통해 애그리게잇 설계를 작고 효율적으로 유지할 수 있게 해준다
 - 관계형 데이터베이스, 문서 데이터베이스, 키/밸류 리파지토리 그리고 데이터 그리드/패브릭과 같은 다른 형태의 저장 메커니즘으로도 쉽게 저장 할 수 있다

### 결과적 일관성을 사용해 다른 애그리게잇을 갱신하라
 - 트랜잭션의 일관성
 - 도메인 이벤트는 애그리게잇에 의해 발행, 구독을 통해서 도메인 이벤트가 전달됨

## 애그리게잇 모델링

### 우선 주의할 것들 
 - 빈약한 도메인 모델
     - 객체지향 도메인 모델 중 모든 애그리게이이 비즈니스 행위가 아닌 읽고 쓰는 공개 접근자만을 갖는 것
     - 모든 오버헤드를 떠안아 버림
 - 비즈니스 로직이 도메인 모델을 넘어 애플리케이션 서비스까지 새어 나가지 않게 하기
     - 비즈니스 로직을 도우미나 유틸리티 클래스에 위임하는 것은 원하는 대로 잘 동작하지 않는다
 - 함수형 프로그래밍? 
     - 빈약한 도메인 모델이 그리 나쁘지 않음
     - 데이터와 행위의 분리를 장려하기 때문

### 추상화를 조심스럽게 선택하라
 - 소프트웨어 모델의 언어가 도메인 전문가의 멘탈 모델과 일치 하지 않을 수 있다
 - 추상화 수준이 너무 높아서 각 개별적 형태의 세부 사항을 모델링하기 시작하면 어려움에 빠진다
 - 복잡한 클래스 계층 구조
 - 중요도가 떨어지는 부분까지 건드리게 됨
 - 미래의 모든 요구를 생각하고 반영할 수는 없다

### 올바른 크기의 애그리게잇
 - 최소 크기의 애그리게잇부터 시작하라
 - 애그리게잇 경계 내의 비즈니스 불변사항을 보호하라
 - 반응에 의한 갱신기 동기적인지 비동기적인지 확인하라
 - 이제 엔터티의 추가를 고려해 보자
 - 복수의 애그리게잇에 대해서 결과적 일관성(트랜잭션)을 사용해 다른 애그리게잇을 갱신하라(도메인 이벤트)
     - 결과적 일관성은 기술 주도가 아닌, 비즈니스 주도

### 테스트 가능한 단위
 - 테스트를 위해 철저하게 캡슐화 하라
 - 단위 테스트: 인수 테스트와는 다르다
    - 단위 테스트는 인수 테스트에 관한 시나리오 명세를 만드는 과정을 따라하는 것?! (뭐라는 거)
 

